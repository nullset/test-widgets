<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="index.css" media="screen" title="no title">
  </head>
  <body>
    
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    
    <div class="table-wrapper">
      <table>
        <!-- <caption>
          <table>
            <tr>
              <th class="th">column 1</th>
              <th class="th">column 2</th>
              <th class="th">column 3</th>
              <th class="th">column 4</th>
              <th class="th">column 5 which is long</th>
              <th class="th">column 6</th>
            </tr>
          </table>
        </caption> -->
        <thead>
          <!-- <tr>
            <th class="th">column 1</th>
            <th class="th">column 2</th>
            <th class="th">column 3</th>
            <th class="th">column 4</th>
            <th class="th">column 5 which is long</th>
            <th class="th">column 6</th>
          </tr> -->
          <tr>
            <th class="th">column 1</th>
            <th class="th">column 2</th>
            <th class="th">column 3</th>
            <th class="th">column 4</th>
            <th class="th">column 5 which is long</th>
            <th class="th">column 6</th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td class="td">ZERO - cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr class="row">
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is extra extra extra extra extra long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
          <tr>
            <td class="td">cell 1</td>
            <td class="td">cell 2</td>
            <td class="td">cell 3</td>
            <td class="td">cell 4</td>
            <td class="td">cell 5 which is long</td>
            <td class="td">cell 6</td>
          </tr>
        </tbody>
      </table>
    </div>
  
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
    <p>a</p>
  
    <script src="jquery-3.1.1.min.js" charset="utf-8"></script>
    <script type="text/javascript">
      var tables = document.querySelectorAll('table');
      
      tables.forEach(function(table) {
        var parent = table.parentElement;
        var theadTR = table.querySelector('thead tr:first-child');
        // var spacer = $(table).find('thead tr:first-child').prepend('<tr><td colspan="' + $(theadTR).find('th').length + '">XXX</td></tr>')
        
        // NOTE : spacer must be *prependend* not appended, otherwise there will be a 1px jank on scroll (appears to be a rendering engine bug).
        var spacer = $(theadTR).clone()
        $(table).find('thead').prepend(spacer);
        spacer.css('visibility', 'hidden')

        theadTR.querySelectorAll('th').forEach(function(th) {
          th.style.width = window.getComputedStyle(th).width;
        });
        // var scrollParent = $(table)
        //   .parents()
        //   .toArray()
        //   .reduce(function(acc, parent) {
        //     if (acc) {
        //       return acc;
        //     } else {
        //       var overflowY = $(parent).css('overflow-y');
        //       console.log(overflowY);
        //       if (overflowY !== 'visible') {
        //         return parent;
        //       }
        //     }
        //   }, undefined);

        var scrollParents = $(table)
          .parents()
          .toArray()
          .filter(function(parent, i, array) {
            var overflowY = $(parent).css('overflow-y');
            if (overflowY !== 'visible') {
              return parent;
            }
          });
        scrollParents.push(document);
          
        scrollParents.forEach(function(elem) {
          elem.onscroll = function(event) {
            theadTR.style.position = 'fixed';
            
            // if (elem === document) {
              // console.log(document.scrollingElement.scrollTop);
              // theadTR.style.top = document.scrollingElement.scrollTop;
              var scrollOffset = scrollParents.reduce(function(acc, parent) {
                if (typeof parent.scrollingElement !== 'undefined') {
                  return parent.scrollingElement.scrollTop;
                } else {
                  return parent.scrollTop;
                }
              }, 0);
              theadTR.style.top = scrollParents[0].offsetTop - scrollOffset + 'px';
            // } else {
            //   console.log(elem.scrollTop);
            // }

            // var theadTR = table.querySelector('thead tr:last-child');
            // if (table.getBoundingClientRect().top !== table.offsetTop) {
            //   theadTR.style.display = 'table-row';
            //   theadTR.style.position = 'fixed';
            //   // theadTR.style.top = 0;
            //   // console.log(table.getBoundingClientRect().top, table.offsetTop, scrollParents.slice(1));
            //   // theadTR.style.top = table.getBoundingClientRect().top + 'px'
            // } else {
            //   theadTR.style.display = 'none';
            // }
          }
        });
        
        // scrollParent.onscroll = function(event) {
        //   var theadTR = table.querySelector('thead tr:last-child');
        //   console.log(this.offsetTop, table.getBoundingClientRect().top);
        //   if (this.offsetTop !== table.getBoundingClientRect().top) {
        //     theadTR.style.display = 'table-row';
        //     theadTR.style.position = 'fixed';
        //     // theadTR.style.top = 0;
        //     theadTR.style.top = scrollParent.offsetTop
        //   } else {
        //     theadTR.style.display = 'none';
        //   }
        // }
        // debugger
      });
    </script>
  </body>
</html>