var BLINK1_VENDOR_ID=10168,BLINK1_PRODUCT_ID=493,DEVICE_INFO={vendorId:BLINK1_VENDOR_ID,productId:BLINK1_PRODUCT_ID},blink1Device,usb=navigator.usb,connected=!1,transferInfo={requestType:"class",recipient:"interface",direction:"out",request:9,value:1,index:0,data:new Uint8Array([1,99,255,204,51,0,32,0,0]).buffer},updateStatus=function(e){blink1Status.innerText=e},randomColor=function(){if(connected){var e=Math.floor(255*Math.random()+0),n=Math.floor(255*Math.random()+0),o=Math.floor(255*Math.random()+0);redval.value=e,grnval.value=n,bluval.value=o,console.log("randomColor: "+e+","+n+","+o),blink1_setColor(e,n,o,100)}},blink1_setColor=function(e,n,o,r){var t="rgb("+e+", "+n+", "+o+")";if(console.log("setColor: "+t),colorswatch.style.backgroundColor=t,connected){var i=r/10>>8,a=r/10&255;transferInfo.data=new Uint8Array([1,99,e,n,o,i,a,0,0]).buffer,usb.controlTransfer(blink1Device,transferInfo,onEvent)}},updateColor=function(){var e=redval.value,n=grnval.value,o=bluval.value,r=70;blink1_setColor(e,n,o,70)};redval.addEventListener("change",function(){updateColor()}),grnval.addEventListener("change",function(){updateColor()}),bluval.addEventListener("change",function(){updateColor()});var onEvent=function(e){if(e.resultCode)return console.log("Error: "+e.error),void(connected=!1)},gotPermission=function(e){requestPermissionDiv.style.display="none",console.log('Appp was granted the "usbDevices" permission.'),usb.findDevices(DEVICE_INFO,function(e){if(!e||!e.length)return updateStatus("no device found"),void console.log("device not found");console.log("Found device: "+e[0].handle),blink1Device=e[0],console.log("blink1Device:"),console.log(blink1Device),updateStatus("connected!"),connected=!0,randomColor()})},permissionObj={permissions:[{usbDevices:[DEVICE_INFO]}]};requestPermission.addEventListener("click",function(){navigator.permissions.request(permissionObj,function(e){e?gotPermission():(console.log('App was not granted the "usbDevices" permission.'),console.log(chrome.runtime.lastError))})});