<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    .blink {
      border-left: 2px solid red;
      margin-left: -1px;
      margin-right: -1px;
      animation: blinker 0.85s infinite;
    }

    @keyframes blinker {
      0% {opacity: 1;}  
      49% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 0;}
    }

.waitingForConnection {
  -webkit-animation-name: blinker;
  -webkit-animation-iteration-count: infinite;
  -webkit-animation-timing-function: cubic-bezier(.5, 0, 1, 1);
  -webkit-animation-duration: 1.7s;
}
  </style>
</head>
<body>

  <form action="" accept-charset="UTF-8">
      <textarea>2&#002;11&#001c;5&#0002;45&#001c;3&#0002;788&#0019;87&#0019;GH&#0019;E\u0044\u0045</textarea>
  </form>
    
  <textarea id="input" cols="50" rows="15" autofocus>
fruits:
󰀃
󰀁apple󰀂
󰀁ban󰀀ana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
fruits:
󰀃
󰀁apple󰀂
󰀁banana󰀂
󰀁cantelope󰀂
󰀄
and other things
  </textarea>

  <div contenteditable="false" id="result" style="border: 1px solid;"></div>

  <script>
  
  const transform = {
    '󰀃': '<ul>',
    '󰀁': '<li>',
    '󰀂': '</li>',
    '󰀄': '</ul>',
    '': '<span class="blink"></span>'
  };

  const t2 = {
    '󰀀': {
      name: 'cursor',
      codePoint: '0xF0000',
      type: 'cursor', // element-open, element-close, style, cursor, selection-start, selection-end,
      transform: {
        type: 'insert',
        value: '<span class="blink"></span>'
      },
    },
    '󰀅': {
      name: 'cursor new',
      codePoint: '0xF0005',
      type: 'cursor', // element-open, element-close, style, cursor, selection-start, selection-end,
      transform: {
        type: 'insert',
        value: '<span class="blink"></span>'
      },
    },
    '󰀁': {
      name: '<li>',
      codePoint: '0xF0001',
      type: 'element-open',
      transform: {
        type: 'insert',
        value: '<li>'
      }
    },
    '󰀂': {
      name: '</li>',
      codePoint: '0xF0002',
      type: 'element-close',
      transform: {
        type: 'insert',
        value: '</li>'
      }
    },
    '󰀃': {
      name: '<ul>',
      codePoint: '0xF0003',
      type: 'element-open',
      transform: {
        type: 'insert',
        value: '<ul>'
      }
    },
    '󰀄': {
      name: '</ul>',
      codePoint: '0xF0004',
      type: 'element-close',
      transform: {
        type: 'insert',
        value: '</ul>'
      }
    },
  }

  // Selection
    // start
    // end

  // paragraph
  // h1-h6
  // code block
  // quote
  // highlight

  // bold
  // italic
  // underline
  // strike

  // left-align
  // center-align
  // right-align
  // justify

  // unordered list
  // ordered list
  // indent
  // outdent

  // table
    // row
    // cell
  // link
  // Image
  // clear formatting

  const result = document.querySelector('#result');
  const input = document.querySelector('#input');

  let newValue = undefined;

  input.addEventListener('keydown', (event) => {
    const code = event.keyCode;
    if (code >= 37 && code <= 40) {
      console.log(code);
  //     newValue = input.value.split('󰀀').join('');
    };
  });
  input.addEventListener('keyup', (event) => {
    const code = event.keyCode;
    if (code >= 37 && code <= 40) {
      // Move cursor
      const cursorStartPos = input.value.indexOf('󰀀');
      var start = input.selectionStart;
      var end = input.selectionEnd;
      var sel = input.value.substring(start, end);
      input.value = input.value.substring(0, start) + '󰀅' + input.value.substring(end, input.value.length);
      input.value = input.value
        .replace('󰀀', '') // Remove old cursor
        .replace('󰀅', '󰀀'); // Replace new cursor character with real cursor character

      // Focus character at proper position
      input.setSelectionRange(start, end);
      refreshView(input, result, t2);

      // const selection = window.getSelection();
      // const range = selection.getRangeAt(0);
      // var selectionContents = range.extractContents();
      // debugger
      // var div = document.createElement("div");
      // div.style.color = "yellow";
      // div.appendChild(selectionContents);
      // range.insertNode(div);
    };
  });

  input.addEventListener('input', (event) => {
    var start = input.selectionStart;
    var end = input.selectionEnd;
    var sel = input.value.substring(start, end);
    refreshView(input, result, t2);
  });

  function refreshView(input, result, transforms) {
    let data = input.value;
    Object.keys(t2).forEach((key) => {
      console.log(key)
      const regex = new RegExp(key, 'g');
      data = data.replace(regex, t2[key].transform.value);
    });

    result.innerHTML = data;
  }

  refreshView(input, result, t2);


  // Object.keys(transform).forEach((key) => {
  //   const regex = new RegExp(key, 'g')
  //   data = data.replace(regex, transform[key]);
  // });


  </script>
        
</body>
</html>